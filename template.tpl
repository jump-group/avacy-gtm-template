___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "displayName": "Avacy CMP",
  "description": "Avacy is a CMP (Consent Management Platform) that helps conform to privacy regulations such as ePrivacy Directive and GDPR. More information at avacysolution.com",
  "categories": [
    "TAG_MANAGEMENT",
    "PERSONALIZATION"
  ],
  "securityGroups": [],
  "id": "avacysolution",
  "type": "TAG",
  "version": 1,
  "brand": {
    "thumbnail": "data:image/png;base64,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",
    "displayName": "Jump Group Srl",
    "id": "github.com_jump-group"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "notSetText": "This field is required for connecting Avacy to Google Tag Manager.",
    "help": "Enter the webspace’s identifying key found at the end of the web space configuration or in the settings under \"Integrating Avacy on your webspace\".",
    "displayName": "Webspace Key",
    "simpleValueType": true,
    "name": "id",
    "type": "TEXT",
    "valueHint": "Insert your Webspace Key",
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$"
        ]
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "team",
    "displayName": "Team Name",
    "simpleValueType": true,
    "help": "Enter the Team name to which the web space belongs. You can find it at the top right of every Avacy page.",
    "valueHint": "Insert your Team Name",
    "notSetText": "This field is required for connecting Avacy to Google Tag Manager."
  },
  {
    "type": "CHECKBOX",
    "name": "advancedOptions",
    "checkboxText": "Enable Advanced Settings",
    "simpleValueType": true,
    "help": "Attention! Change the following settings only if you are an advanced user."
  },
  {
    "type": "TEXT",
    "name": "version",
    "displayName": "Chose specific version",
    "simpleValueType": true,
    "help": "Fill this field only if you want to force a specific banner version.",
    "enablingConditions": [
      {
        "paramName": "advancedOptions",
        "paramValue": true,
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "REGEX",
        "args": [
          "^\\d+(\\.\\d+)*$"
        ]
      }
    ]
  },
  {
    "type": "TEXT",
    "name": "overrides",
    "displayName": "Override banner configuration",
    "simpleValueType": true,
    "lineCount": 10,
    "enablingConditions": [
      {
        "paramName": "advancedOptions",
        "paramValue": true,
        "type": "EQUALS"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const injectScript = require('injectScript');
const encodeUriComponent = require('encodeUriComponent');
const queryPermission = require('queryPermission');
const gtagSet = require('gtagSet');
const log = require('logToConsole');
const JSON = require('JSON');
const setDefaultConsentState = require('setDefaultConsentState');
const getCookieValues = require('getCookieValues');
const updateConsentState = require('updateConsentState');
const avacyId = data.id;
const avacyTeam = data.team;
const enableOverrides = data.enableOverrides;
const advancedOptions = data.advancedOptions;
const version = data.version;
let overrides = data.overrides;
let hasDefaultState = false;
let encodedOverrides = '';

function main() {
  if(!hasDefaultState) {
    setDefaultConsentState({
      ad_storage: 'denied',
      ad_user_data: 'denied',
      ad_personalization: 'denied',
      analytics_storage: 'denied',
      functionality_storage: 'denied',
      personalization_storage: 'denied',
      security_storage: 'denied'
    });
  }
  
  log(avacyId);
  log(avacyTeam);
  log(version);

  if (!avacyId || !avacyTeam) {
    log('Avacy ID or Team not set');

    data.gtmOnFailure();
    return;
  }    

  if (getCookieValues("oil_data").toString() !== '') {
    const avacy_cookie = getCookieValues("oil_data")[0];
    log(avacy_cookie);
  }
  
  let version_in_use = 'current';
  if (advancedOptions) {
    overrides = JSON.parse(overrides);
    log(overrides);
    if(version) {
      version_in_use = 'versions/'+ version;
    }
    log(version_in_use);
    if(!overrides && version) {
      log('https://' + avacyTeam + '.avacy-cdn.com/'+ version_in_use +'/dist/');
      overrides = {};
      overrides.publicPath = 'https://' + avacyTeam + '.avacy-cdn.com/'+ version_in_use +'/dist/';
    }
    
    log(overrides);
    encodedOverrides = '&overrides=' + encodeUriComponent(JSON.stringify(overrides));
  }
  
  log(encodedOverrides);
  log(version_in_use);

  log('arrivo qui');
  embedScripts(() => {
    log('Avacy scripts embedded');

    data.gtmOnSuccess();
  }, () => {
    log('Avacy scripts failed to embed');

    data.gtmOnFailure();
  }, version_in_use);
}

function embedScripts(onSuccess, onFail, version_in_use) {
  const scriptsToEmbed = [];
  scriptsToEmbed.push('https://' + avacyTeam + '.avacy-cdn.com/'+ version_in_use +'/dist/oil.min.js?team='+ encodeUriComponent(avacyTeam) +'&uuid='+ encodeUriComponent(avacyId) + encodedOverrides);
  scriptsToEmbed.push('https://' + avacyTeam + '.avacy-cdn.com/'+ version_in_use +'/dist/oilstub.min.js');
  log(scriptsToEmbed);

  let scriptsInjected = 0;
  let failed = false;

  const localOnSuccess = () => {
    scriptsInjected++;

    if (scriptsInjected === scriptsToEmbed.length && !failed) {
      onSuccess();
    }
  };

  const localOnFail = () => {
    if (!failed) {
      failed = true;
      onFail();
    }
  };

  for (const script of scriptsToEmbed) {
    log(script);
    injectScript(script, onSuccess, onFail);
  }

  if (scriptsToEmbed.length === 0) {
    onSuccess();
  }
}

main();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.avacy-cdn.com/"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_consent",
        "versionId": "1"
      },
      "param": [
        {
          "key": "consentTypes",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "analytics_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "functionality_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "personalization_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "security_storage"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_user_data"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "ad_personalization"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "consentType"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "wait_for_update"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "oil_data"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "write_data_layer",
        "versionId": "1"
      },
      "param": []
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []
setup: ''


___NOTES___

Created on 1/3/2024, 10:10:37


